# User Feedback Loop System 가이드

## 개요

User Feedback Loop System은 사용자 피드백을 통해 뉴스 필터링 로직을 개선하는 시스템입니다. 사용자가 특정 뉴스에 대한 피드백을 스프레드시트에 기록하면, 시스템이 이를 분석하여 향후 유사한 뉴스의 가중치를 높이고 리포트에 반영합니다.

## 작동 원리

1. **피드백 수집**: 사용자가 스프레드시트에 뉴스에 대한 피드백을 기록
2. **임베딩 생성**: 피드백과 뉴스의 임베딩 벡터 생성
3. **유사도 계산**: 코사인 유사도를 사용하여 피드백과 유사한 뉴스 찾기
4. **가중치 적용**: 유사한 뉴스의 중요도 점수에 가중치 적용
5. **리포트 반영**: 리포트 생성 시 피드백 의견과 링크 자동 포함

## 사용 방법

### 1. 피드백 탭 생성

먼저 스프레드시트에 피드백 탭을 생성합니다:

```bash
python setup_feedback_sheet.py
```

이 스크립트는 실행 결과 스프레드시트에 "사용자 피드백" 탭을 생성하고 예시 데이터를 추가합니다.

### 2. 피드백 기록

스프레드시트의 "사용자 피드백" 탭에 다음 형식으로 피드백을 기록하세요:

| date | news_title | source | user_comment |
|------|-----------|--------|--------------|
| 2025-12-14 | 삼성전자, HBM4 개발 가속화 | 한국경제 | 기존 뉴스와는 반대의견이지만 중요한 고려사항이니 이런 의견도 있다는 것을 반영해줘. |

**필수 필드:**
- `date`: 날짜 (YYYY-MM-DD 형식 권장)
- `news_title`: 뉴스 제목
- `source`: 뉴스 출처 (선택사항)
- `user_comment`: 사용자 피드백 (중요한 이유)

### 3. 시스템 실행

피드백을 기록한 후 뉴스 수집 및 분석을 실행하면:

1. **뉴스 분석 시**: 피드백과 유사한 뉴스의 `importance_score`가 자동으로 상승합니다.
   - 유사도 임계값: 0.7 (설정 가능)
   - 최대 가중치: 1.5배 (설정 가능)

2. **리포트 생성 시**: 피드백과 매칭된 뉴스에 대해:
   - 피드백 의견이 자동으로 포함됩니다
   - 뉴스 링크가 포함됩니다

## 기술적 세부사항

### 모듈 구조

1. **`modules/feedback_loader.py`**: 스프레드시트에서 피드백 로드
2. **`modules/feedback_analyzer.py`**: 피드백 임베딩 생성 및 유사도 계산
3. **`modules/news_analyzer.py`**: 뉴스 분석 시 피드백 가중치 적용
4. **`generate_daily_report.py`**: 리포트 생성 시 피드백 반영

### 가중치 적용 로직

```python
# 유사도가 0.7 이상인 뉴스에 가중치 적용
similarity >= 0.7:
    weight = 1.0 + (similarity - 0.7) / (1.0 - 0.7) * (1.5 - 1.0)
    new_score = original_score * weight
```

### 설정 가능한 파라미터

`modules/feedback_analyzer.py`에서 다음 파라미터를 조정할 수 있습니다:

- `similarity_threshold`: 유사도 임계값 (기본값: 0.7)
- `max_boost`: 최대 가중치 배수 (기본값: 1.5)

## 예시

### 피드백 입력

```
date: 2025-12-14
news_title: 삼성전자, HBM4 개발 가속화
source: 한국경제
user_comment: 기존 뉴스와는 반대의견이지만 중요한 고려사항이니 이런 의견도 있다는 것을 반영해줘.
```

### 리포트 출력

리포트의 해당 뉴스 섹션에 다음과 같이 표시됩니다:

```markdown
**📰 Key News:**
- [25.12.14] 삼성전자, HBM4 개발 가속화 - [링크](https://...)

  **💬 사용자 피드백:**
  - 기존 뉴스와는 반대의견이지만 중요한 고려사항이니 이런 의견도 있다는 것을 반영해줘.
```

## 주의사항

1. **임베딩 API 필요**: 피드백 분석을 위해 OpenAI API 키가 필요합니다.
2. **성능**: 피드백이 많을수록 임베딩 생성 시간이 증가합니다.
3. **정확도**: 유사도 임계값을 너무 낮추면 관련 없는 뉴스에도 가중치가 적용될 수 있습니다.

## 문제 해결

### 피드백이 반영되지 않는 경우

1. 스프레드시트의 "사용자 피드백" 탭이 올바르게 생성되었는지 확인
2. 피드백 데이터 형식이 올바른지 확인 (date, news_title, user_comment 필수)
3. 로그에서 피드백 로드 및 가중치 적용 메시지 확인

### 유사도가 낮은 경우

1. 피드백의 `user_comment`에 더 구체적인 내용 추가
2. `news_title`이 실제 뉴스 제목과 일치하는지 확인
3. `similarity_threshold` 값을 낮춰서 더 많은 뉴스에 적용



